{% extends "layout.html" %}
{% set active_page = "home" %}

{% import 'macros/critical_notifications_alert.html' as m_critical_notifications_alert %}

{% macro waiter(waiter_id, title) %}
<div id="{{waiter_id}}" class="text-center my-4 py-4 h-100">
    <div class="py-4">
        <h2>{{title}}</h2>
    </div>
    <div class="py-4">
        <h2><i class="fa fa-spinner fa-spin"></i></h2>
    </div>
</div>
{% endmacro %}


{% block body %}
    <br>

    {{ m_critical_notifications_alert.critical_notifications_alert(critical_notifications) }}
    <span id="exchange-specific-data">
        {% if might_have_positions %}
        <div class="card">
            <div class="card-header">
                <h4>Positions</h4>
            </div>
            <div class="card-body">
                {{ waiter("positions-waiter", "Loading positions") }}
                <div class='progress mb-1' id='cancel_position_progress_bar' style='display: none;'>
                    <div class='progress-bar progress-bar-striped progress-bar-animated' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>
                </div>
                <div id="positionTable">
                  <table id="positions-table"
                         data-url="{{url_for('api.positions')}}"
                         data-close-url="{{url_for('api.positions', action='close_position')}}"
                         class="w-100 table-striped table-responsive-sm">
                  </table>
                </div>
            </div>
        </div>

        <br>
        {% endif %}

        <div class="card">
            <div class="card-header text-center">
                <h4>Open orders</h4>
            </div>
            <div class="card-body">
                {{ waiter("orders-waiter", "Loading orders") }}
                <div class='progress mb-1' id='cancel_order_progress_bar' style='display: none;'>
                    <div class='progress-bar progress-bar-striped progress-bar-animated' role='progressbar' aria-valuenow='100' aria-valuemin='0' aria-valuemax='100' style='width: 100%;'></div>
                </div>
                <div id="openOrderTable">
                  <table id="orders-table"
                         data-url="{{url_for('api.orders')}}"
                         class="w-100 table-striped table-responsive-sm">
                  </table>
                </div>
            </div>
        </div>

        <br>
    </span>

    <br>

    <div class="card">
        <div class="card-header text-center">
            <h4>Trades history</h4>
        </div>
        <div class="card-body">
            {{ waiter("trades-waiter", "Loading trades") }}
            <table id="trades-table"
                 data-url="{{url_for('api.trades')}}"
                 data-reference-market="{{reference_market}}"
                 class="w-100 table-striped table-responsive-sm">
            </table>
        </div>
    </div>

    <div class="text-right my-5">
        <button type="button" class="btn btn-outline-primary btn-lg" route="{{ url_for('commands', cmd='stop') }}">
            <i class="fa fa-power-off" aria-hidden="true"></i> Stop OctoBot
        </button>
    </div>

    <span class="d-none"
          data-display-intro="{{display_intro}}"
    ></span>
{% endblock %}

{% block additional_scripts %}
    <script src="{{ url_for('static', filename='js/common/custom_elements.js', u=LAST_UPDATED_STATIC_FILES) }}"></script>
    <script src="{{ url_for('static', filename='js/common/portfolio_history.js', u=LAST_UPDATED_STATIC_FILES) }}"></script>
    <script src="{{ url_for('static', filename='js/common/tables_display.js', u=LAST_UPDATED_STATIC_FILES) }}"></script>
    <script src="{{ url_for('static', filename='js/components/trading.js', u=LAST_UPDATED_STATIC_FILES) }}"></script>
    <script src="{{ url_for('static', filename='distributions/prediction_market/js/dashboard.js', u=LAST_UPDATED_STATIC_FILES) }}"></script>
{% endblock additional_scripts %}
